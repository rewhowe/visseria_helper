function titleCase(e){return e.split(/ |_/).map(e=>e[0].toUpperCase()+e.slice(1)).join(" ")}function studlyCase(e){return e.split(/ |_/).map(e=>e[0].toUpperCase()+e.slice(1)).join("")}function int(e){return parseInt(e)||0}$(function(){if(window.matchMedia("only screen and (min-width: 640px)").matches)return;const e=$(".js-up-button"),t=$(".js-down-button");$(document).on("focus",'input[type="number"]',function(){let a=this.getBoundingClientRect();e.removeClass("hidden").css({top:a.y+window.pageYOffset+"px",left:a.right+window.pageXOffset+"px"}),t.removeClass("hidden").css({top:a.y+window.pageYOffset+"px",left:a.left-t.outerWidth()+window.pageXOffset+"px"})}).on("focusout",'input[type="number"]',function(){e.addClass("hidden"),t.addClass("hidden")}),e.on("mousedown",function(e){const t=$('input[type="number"]:focus');t.val(int(t.val())+1).trigger("change"),e.preventDefault()}),t.on("mousedown",function(e){const t=$('input[type="number"]:focus');t.val(int(t.val())-1).trigger("change"),e.preventDefault()}),$(document).on("change",'input[type="number"]',function(){let e=int($(this).val());this.max&&(e=Math.min(this.max,e)),this.min&&(e=Math.max(this.min,e)),$(this).val(e)})});const Select={KEY_DELIMITER:".",makeKey:function(e,t){return e+Select.KEY_DELIMITER+t},makeSelect:function(e,t,a=!0){const s=$('<select class="'+t+'">');s.append("<option selected"+(a?" disabled":"")+">-</option>");for(let t in e){$optGroup=$('<optgroup label="'+titleCase(t)+'">');for(let a in e[t]){const s=t+Select.KEY_DELIMITER+a,i=$('<option value="'+s+'">'+titleCase(e[t][a])+"</option>");$optGroup.append(i)}s.append($optGroup)}return s}},Gear={GEAR:{basic_gear:{angel_feather:{cost:3,dmg:0,hp:1,spec:1,spec_type:"soul"},ring_of_remnai:{cost:3,dmg:0,hp:1,spec:1,spec_type:"intelligence"},badge_of_heroism:{cost:3,dmg:1,hp:0,spec:1,spec_type:"courage"},blank_totem:{cost:3,dmg:0,hp:1,spec:1,spec_type:"aura"},loaded_die:{cost:3,dmg:1,hp:0,spec:1,spec_type:"luck"}},intermediate_gear:{exxo_armor:{cost:5,dmg:0,hp:3,spec:2,spec_type:"soul"},trinity_staff:{cost:5,dmg:1,hp:2,spec:2,spec_type:"intelligence"},darkling_sword:{cost:5,dmg:3,hp:0,spec:2,spec_type:"courage"},illumination_pendant:{cost:5,dmg:0,hp:3,spec:2,spec_type:"aura"},broken_dagger:{cost:5,dmg:2,hp:1,spec:2,spec_type:"luck"}},standard_gear:{thirstfire:{cost:5,dmg:2,hp:0,effect:"Enemies the equipped User attacks are debuffed with Bleed"},mugger_dagger:{cost:5,dmg:2,hp:0,effect:"Equipped User gains 1G for every successful attack on an Enemy if Success roll"},bones:{cost:5,dmg:1,hp:5,effect:"While equipped with Bones: equipped User is debuffed with Undead"},lucky_charm:{cost:5,dmg:1,hp:1,effect:"Equipped User gains +2 Success roll"},devil_charm:{cost:5,dmg:3,hp:3,effect:"Equipped User gains -2 Success roll"},courage_charm:{cost:5,dmg:2,hp:1,effect:"Equipped User gains +1 Decisive roll in battle involving User"},artifact_coin:{cost:5,dmg:2,hp:2,effect:"Item is treated as 5G"},absorbing_spirit:{cost:5,dmg:2,hp:2,effect:"Equipped User's Ultimate recharge rate is 2"},regenerating_armour:{cost:5,dmg:0,hp:3,effect:"Any DMG the equipped User receives from any source is reduced by 1 DMG"},the_murmur:{cost:5,dmg:5,hp:0,effect:"While equipped with The Murmur: equipped User is debuffed with Silence"}},legendary_gear:{"wilhelm's_gauntlet":{cost:15,dmg:0,hp:5,limit_class:"guardian",effect:"When the equipped User is attacked: deal DMG equal to the equipped User's DMG to the attacking Enemy. Can only be equipped by Guardians",spec:3,spec_type:"soul"},"solomon's_cipher":{cost:15,dmg:2,hp:3,limit_class:"spellweaver",effect:"The equipped User can attack and use abilities once each before becoming inactive. Can only be equipped by Spellweavers",spec:3,spec_type:"intelligence"},"zatyr's_saber":{cost:15,dmg:5,hp:0,limit_class:"slayer",effect:"When the equipped User attacks: equipped User recovers (Room Lvl) HP. Can only be equipped by Slayers",spec:3,spec_type:"courage"},"magus'_cloak":{cost:15,dmg:1,hp:4,limit_class:"enchanter",effect:"Remove all debuffs from the equipped User. Equipped User is immune to debuffs. Can only be equipped by Enchanters",spec:3,spec_type:"aura"},"weeper's_satchel":{cost:15,dmg:3,hp:2,limit_class:"trickster",effect:"When this item is acquired: acquire 1 Item and +XG equal to D10 roll. The equipped User gains +2 Success roll. Can only be equipped by Tricksters",spec:3,spec_type:"luck"}}},getGear:function(e){e=e.split(Select.KEY_DELIMITER);const t=Gear.GEAR[e[0]];if(!t)return;const a=t[e[1]];return a.category=e[0],a.name=e[1],a},getGearKey:function(e){return Select.makeKey(e.category,e.name)}};Gear.$GEAR_SELECT=function(){const e={};for(let t in Gear.GEAR){e[t]={};for(let a in Gear.GEAR[t]){const s=Gear.GEAR[t][a],i=[s.dmg||0,s.hp||0,s.spec?s.spec+" "+s.spec_type:0];e[t][a]=a+" ("+i.join("/")+")"+(s.limit_class?" - "+titleCase(s.limit_class)+" only":"")}}return Select.makeSelect(e,"js-gear-select",!1)}();const Classes={CLASSES:{guardian:{spec_type:"soul",characters:{albatross_grand:{title:"The Armored Angel",dmg:2,hp:18,abilities:{passive:{name:"Endure",effect:"Any DMG Albatross Grand receives is reduced by (Room Lvl). When Albatross Grand activates an Ultimate ability: this ability is negated"},active:{name:"Divine Intervention",effect:"When an ally User is attacked: Albatross Grand is attacked instead"},ultimate:{name:"Beckoning Light",effect:"Enemies can only attack Albatross Grand. Any DMG Albatross Grand receives is reduced by (Soul Lvl) DMG. This ability lasts until Albatross Grand becomes active",recharge:7}}},T4O_MKII:{title:"The Soul in the Shell",dmg:3,hp:17,abilities:{passive:{name:"Welded Will",effect:"T4O MKII cannot be debuffed with Bleed or Fear. T4O MKII gains (Soul Lvl) Max HP"},active:{name:"Self Destruct",effect:"T4O MKII deals X DMG to 1 Enemy and loses X HP (X cannot be greater than T4O MKII's current HP)"},ultimate:{name:"Recharge",effect:"T4O MKII Recovers to Max HP",recharge:7}}},lilith:{title:"The Bad Blood",dmg:1,hp:16,abilities:{passive:{name:"Tear",effect:"When Lilith attacks an Enemy: the attacked Enemy is debuffed with Bleed"},active:{name:"Blood Drain",effect:"If an active Enemy is debuffed with Bleed, remove the debuff: deal (Soul Lvl) DMG to that Enemy. Lilith Recovers (Soul Lvl) HP"},ultimate:{name:"Vampirism",effect:"All enemies are now debuffed with Bleed",recharge:6}}}}},spellweaver:{spec_type:"intelligence",characters:{harmony_marx:{title:"The Sorcerer Songstress",dmg:4,hp:14,abilities:{passive:{name:"Tempo",effect:"When Harmony Marx attacks an enemy: Harmony Marx gains + (Intelligence Lvl) Success roll. This effect stacks but resets when Harmony Marx leaves the current Room, Dies or uses an ability"},active:{name:"Song of Silence",effect:"Success roll: debuff (Intelligence Lvl) Enemies with Silence until Harmony Marx becomes active"},ultimate:{name:"Da Capo",effect:"Success roll: all inactive Users become active",recharge:10}}},ariadne:{title:"The Blind Prophet",dmg:5,hp:11,abilities:{passive:{name:"Dimensional Decision",effect:"Once during your turn when a Room Tile is revealed: reveal the top 3 Room Cards of that revealed Room Tile from the respective deck and choose 1. The revealed Room Tile is now that chosen Room Card. Shuffle the other Room Cards revealed this way back into their respective decks"},active:{name:"Darkness Falls",effect:"Success roll: debuff (Intelligence Lvl) Enemies with Blind until Ariadne becomes active"},ultimate:{name:"Foreseer's Favour",effect:"Ariadne gains the following ability based on the current Room type:\nMob/Boss Room - Once per Room: Ariadne gains (Intelligence Lvl) DMG for the Room\nTrap Room - Ariadne gains + (Intelligence Lvl) Success roll\nTreasure Room - Acquire 1 Item if an Item is acquired",recharge:5}}},psykoshka:{title:"The Lost Familiar",dmg:4,hp:13,abilities:{passive:{name:"Symmetry",effect:"Psykoshka gains (Intelligence Lvl) DMG"},active:{name:"Copycat",effect:"Psykoshka can use the active ability of 1 ally User and gains that User's Special Stat and Special Stat Lvl until Psykoshka becomes active"},ultimate:{name:"Loyalty",effect:"Ally Users gain (Intelligence Lvl) Special Stat Lvl until Psykoshka becomes active",recharge:8}}}}},slayer:{spec_type:"courage",characters:{grimwulf_kaiser:{title:"The Howling Death",dmg:9,hp:9,abilities:{passive:{name:"Battle Howl",effect:"Gain + (Courage Lvl) Decisive roll"},active:{name:"Duality",effect:"Deal half of DMG + (Courage Lvl) (rounded up) to 2 different Enemies "},ultimate:{name:"Hellhound",effect:"Spawn a Hellhound Token with (Courage Lvl) DMG and (Courage Lvl) Max HP. Hellhound Token is treated as an ally User (cannot acquire or hold Gear). There can only be 1 Hellhound Token at a time",recharge:5}}},jackal:{title:"The Soundslinger",dmg:7,hp:7,abilities:{passive:{name:"Sonic Snipe",effect:"During Battle before Decisive roll, Success roll: Jackal can immediately attack 1 Enemy"},active:{name:"Distortion",effect:"Deal (Courage Lvl) DMG to all Enemies with debuffs"},ultimate:{name:"EQ",effect:"Target 1 User and 1 Basic Enemy: Halve the sum of those targets' current HP (rounded up). The targeted User and Basic Enemy's HP become the result",recharge:7}}},vulcana:{title:"The Pyroxian Flame",dmg:8,hp:8,abilities:{passive:{name:"Overheat",effect:"When Vulcana defeats an Enemy: deal any overkill DMG to another Enemy"},active:{name:"Fever",effect:"Vulcana gains (Courage Lvl) DMG for the next attack"},ultimate:{name:"Pyreball",effect:"Success roll: Vulcana deals DMG + (Courage Lvl) to 1 Enemy. This ability repeats 3 times",recharge:6}}}}},enchanter:{spec_type:"aura",characters:{misteyes_snow:{title:"The White Fox",dmg:3,hp:14,abilities:{passive:{name:"Empath",effect:"When Misteyes Snow Recovers HP: Recover 1 ally User for the same amount + (Aura Lvl) HP"},active:{name:"Erasure",effect:"Remove all debuffs on (Aura Lvl) ally Users"},ultimate:{name:"Light of Life",effect:"If an ally User is Dead: Resurrect the Dead User",recharge:10}}},dexler:{title:"The Mad Alchemist",dmg:1,hp:11,abilities:{passive:{name:"Duplicate",effect:"When a Consumable Item would be discarded, Success roll: the Consumable Item is not discarded"},active:{name:"Alchemic Warfare",effect:"Discard 1 Consumable Item: deal 5 + (Aura Lvl) DMG to 1 Enemy or 1 ally User Recovers 5 + (Aura Lvl) HP"},ultimate:{name:"The Creator",effect:"Search for 1 Consumable Item in the Item deck and acquire it",recharge:7}}},faerie:{title:"The Fable of the Forest",dmg:0,hp:13,abilities:{passive:{name:"Blessing of the Fae",effect:"While Faerie is at Max HP: Faerie and ally Users gain + 1 Success roll and (Room Lvl) DMG"},active:{name:"Sacred Medicine",effect:"1 User Recovers (Aura Lvl) HP"},ultimate:{name:"Faeth",effect:"1 active User Recovers to Max HP and loses all debuffs. That User becomes inactive",recharge:7}}}}},trickster:{spec_type:"luck",characters:{ein:{title:"The Shadewalker",dmg:5,hp:10,abilities:{passive:{name:"Get Chance and Luck",effect:"When Ein or an ally User pass a Success roll: Ein gains (Luck Lvl) DMG. This effect can stack but resets if Ein leaves the current Room, Dies or if a Success roll fails"},active:{name:"Gamble",effect:"Ally Users gain + (Luck Lvl) Success roll. This ability can be used in a Trap Room and lasts until Ein becomes active"},ultimate:{name:"Shadow Sneak",effect:"Upon discovering a Trap Room, Success roll: that discovered Trap Room is disabled",recharge:7}}},zuciel:{title:"The Phantom of Sin",dmg:0,hp:13,abilities:{passive:{name:"Greed",effect:"Zuciel cannot gain DMG from any Gear but gains DMG equal to the Party’s total G. Zuciel's Party can buy Items for 1 less G. This ability cannot be negated by Silence"},active:{name:"Sloth",effect:"Zuciel Recovers (Luck Lvl) HP"},ultimate:{name:"Wrath",effect:"If all ally Users are active: Zuciel can attack (Luck Lvl) Enemies once each. All ally Users become inactive",recharge:5}}},marina:{title:"The Chronokeeper",dmg:5,hp:10,abilities:{passive:{name:"Choice of Chronos",effect:"When an Item is acquired: Marina can discard the Item and acquire a new one instead. This can be repeated (Luck Lvl) times"},active:{name:"Rewrite Destiny",effect:"Whenever a die is rolled: Marina can ignore the result and roll once more"},ultimate:{name:"Gift of the Chronokeepers",effect:"Once per Room: all ally Users’ Ultimate Gauge recharge by (Luck Lvl) ",recharge:10}}}}}},getCharacterData:function(e){e=e.split(Select.KEY_DELIMITER);const t=Classes.CLASSES[e[0]].characters[e[1]];return t.class=e[0],t.name=e[1],t.specType=Classes.CLASSES[e[0]].spec_type,t},makeCharacter:function(e,t,a=null){console.log(t);const s=studlyCase(t.split(Select.KEY_DELIMITER)[1]);return Classes[s]?new Classes[s](e,t,a):new Character(e,t,a)}};Classes.$CLASS_SELECT=function(){const e={};for(let t in Classes.CLASSES){e[t]={};for(let a in Classes.CLASSES[t].characters)e[t][a]=a}return Select.makeSelect(e,"js-class-select")}();class Character{static get MAX_LEVEL(){return 3}static get LEVEL_BONUS(){return 2}constructor(e,t,a=null){this.$node=e;const s=Classes.getCharacterData(t);this.class=s.class,this.name=s.name,this.specType=s.specType,this.abilities=s.abilities,this.$node.removeClass(Object.keys(Classes.CLASSES).join(" ")).addClass(this.class),this.level=0,this.globalMod={dmg:0},this.$title=this.$node.find(".js-title").html(s.title),this.$class=this.$node.find(".js-class-select"),this.$debuffs=this.$node.find('.js-debuff input[type="checkbox"]');for(let e of this.$debuffs)$(e).prop("checked",!1).parent().removeClass("checked");this.$ultimate=this.$node.find(".js-ability-ultimate"),this.setAbilities(),this.hp={current:s.hp,base:s.hp,$current:this.$node.find(".js-hp-current").val(s.hp),$value:this.$node.find(".js-hp-max"),$detail:this.$node.find(".js-hp-detail"),$mod:this.$node.find(".js-hp-mod")},this.dmg={base:s.dmg,$value:this.$node.find(".js-dmg-value").val(s.dmg),$detail:this.$node.find(".js-dmg-detail"),$mod:this.$node.find(".js-dmg-mod")},this.spec={base:1,$name:this.$node.find(".js-spec-name").html(titleCase(s.specType)),$value:this.$node.find(".js-spec-value"),$detail:this.$node.find(".js-spec-detail"),$mod:this.$node.find(".js-spec-mod")},this.recharge={current:0,base:s.abilities.ultimate.recharge,$current:this.$node.find(".js-recharge-current").val(0),$value:this.$node.find(".js-recharge-value"),$detail:this.$node.find(".js-recharge-detail"),$mod:this.$node.find(".js-recharge-mod")},this.gear=[],this.$gear=this.$node.find(".js-gear"),this.$gear.find(".js-gear-select").val("-"),this.$node.find(".js-gear-show-detail, .js-gear-detail").addClass("hidden").removeClass("pressed"),this.$node.find(".js-status-mod").val(""),a&&this.fromBundle(a);for(let e of["hp","dmg","spec","recharge"])this.mod(e);this.$node.find(".js-character-detail").slideDown()}setAbilities(){for(let e in this.abilities){const t=this.abilities[e];this.$node.find(".js-ability-"+e+" .js-ability-name").html(t.name),this.$node.find(".js-ability-"+e+" .js-ability-detail").html(t.effect)}}mod(e){const t=this.getStatusMod(e),a=this[e].base+this.getLevelMod(e),s=Math.max(0,a+t);return this[e].$value.html(s),this.updateStatusDetail(e,t,a),this.updateCurrentStatus(e,s),s}getLevelMod(e){return-1===["hp","dmg"].indexOf(e)?0:"zuciel"==this.name&&"dmg"==e?0:this.level*Character.LEVEL_BONUS}getStatusMod(e){return int(this[e].$mod.val())+this.getGearMod(e)+this.getGlobalCharacterMod(e)}getGearMod(e){const t=this.specType;return this.gear.reduce(function(a,s){return!s||"spec"===e&&s.spec_type&&s.spec_type!==t||(a+=s[e]||0),a},0)}getGlobalCharacterMod(e){return $(".js-character").toArray().reduce(function(t,a){const s=$(a).data("character");return t+(s?int(s.globalMod[e]):0)},0)}updateStatusDetail(e,t,a){if(0!==t){const s=t>0?" + ":" - ";this[e].$detail.html(a+s+Math.abs(t)),this[e].$detail.parent().addClass("character-status-modified")}else this[e].$detail.html(""),this[e].$detail.parent().removeClass("character-status-modified")}updateCurrentStatus(e,t){-1!==["hp","recharge"].indexOf(e)&&(this[e].current=Math.min(this[e].current,t),this[e].$current.val(this[e].current),"recharge"===e&&(this.recharge.current===t?this.$ultimate.addClass("charged"):this.$ultimate.removeClass("charged")))}changeCurrent(e){this[e].current=int(this[e].$current.val()),this.mod(e),"hp"===e&&0===this.hp.current?this.$node.addClass("dead"):this.$node.removeClass("dead")}changeGear(e,t){const a=Gear.getGear(t),s=a&&(!a.limit_class||this.class===a.limit_class);this.gear[e]=s?a:void 0;for(let e of["hp","dmg","spec","recharge"])this.mod(e);return this.updateGearEffect(this.gear[e],$(this.$gear[e])),s}updateGearEffect(e,t){e&&e.effect?(t.find(".js-gear-show-detail").removeClass("hidden"),t.find(".js-gear-detail").html(e.effect)):(t.find(".js-gear-show-detail, .js-gear-detail").addClass("hidden"),t.find(".js-gear-detail").html(""))}updateLevel(e){this.level=Math.min(Character.MAX_LEVEL,Math.max(0,e)),this.mod("hp"),this.mod("dmg"),this.hp.$current.val(this.hp.base+this.getLevelMod("hp")+this.getStatusMod("hp")),this.changeCurrent("hp")}toBundle(){const e={debuffs:this.$debuffs.map((e,t)=>t.checked).toArray(),character_key:Select.makeKey(this.class,this.name),level:this.level,hp:{current:this.hp.current,mod:int(this.hp.$mod.val())},dmg:{mod:int(this.dmg.$mod.val())},spec:{mod:int(this.spec.$mod.val())},recharge:{current:this.recharge.current,mod:int(this.recharge.$mod.val())},gear:[]};for(let t of this.gear)t&&e.gear.push(Gear.getGearKey(t));return e}fromBundle(e){this.$class.val(e.character_key),this.level=e.level;for(let t in e.gear)this.gear[t]=Gear.getGear(e.gear[t]),$(this.$gear[t]).find(".js-gear-select").val(e.gear[t]),this.updateGearEffect(this.gear[t],$(this.$gear[t]));for(let t of["hp","dmg","spec","recharge"])this[t].$mod.val(int(e[t].mod)),-1!==["hp","recharge"].indexOf(t)&&(this[t].current=e[t].current);for(let t in e.debuffs)e.debuffs[t]&&$(this.$debuffs[t]).prop("checked",!0).parent().toggleClass("checked")}}Classes.Faerie=class extends Character{mod(e){const t=super.mod(e);if("hp"===e){const e=this.hp.current===t?int($(".js-key-shards").val()):0;e!==this.globalMod.dmg&&(this.globalMod.dmg=e,$(".js-character").each(function(e,t){const a=$(t).data("character");a&&a.mod("dmg")}))}return t}},Classes.T4OMKII=class extends Character{mod(e){const t=super.mod(e);return"spec"===e&&this.mod("hp"),t}getStatusMod(e){return super.getStatusMod(e)+("hp"===e?this.spec.base+this.getStatusMod("spec"):0)}},Classes.Zuciel=class extends Character{mod(e){const t=this.getStatusMod(e),a=("dmg"===e?int($(".js-gold").val()):this[e].base)+this.getLevelMod(e),s=Math.max(0,a+t);return this[e].$value.html(s),this.updateStatusDetail(e,t,a),this.updateCurrentStatus(e,s),s}updateStatusDetail(e,t,a){if(0!==t){const s=t>0?" + ":" - ";this[e].$detail.html(a+s+Math.abs(t)),this[e].$detail.parent().addClass("character-status-modified")}else"dmg"===e&&0!==int($(".js-gold").val())?(this[e].$detail.html(""),this[e].$detail.parent().addClass("character-status-modified")):(this[e].$detail.html(""),this[e].$detail.parent().removeClass("character-status-modified"))}getGearMod(e){return"dmg"===e?0:super.getGearMod(e)}},$(function(){const e="v2";$(".js-version").html(e);const t=5,a=5e3,s={MESSAGE:"Would you like to save your data locally?",NO:"No, don't!",YES:"Sure"},i={MESSAGE:"Hey, we've updated, so old data will be deleted. Sorry!<br>Do you still want to save your data locally?",NO:"Nah",YES:"Yes please!"},r=$(".js-storage-prompt"),n=$(".js-character-template .js-character"),c=$(".js-key-shards"),l=$(".js-gold"),o=$(".js-main-content"),d=$(".js-add-character");let h=null,u=null;function m(){try{return!!localStorage}catch(e){return!1}}function f(e=null){const t=n.clone();t.insertBefore(d.parent()),e&&p(t,e.character_key,e)}function p(e,t,a=null){const s=Classes.makeCharacter(e,t,a);e.data("character",s),c.trigger("change")}function g(){o.find(".js-character").length>=t?d.hide():d.show()}function v(){m()&&(window.clearTimeout(u),u=window.setTimeout(y,a))}function y(){h[e]={key_shards:int(c.val()),gold:int(l.val()),characters:[]},o.find(".js-character").each(function(t,a){const s=$(a).data("character");s&&h[e].characters.push(s.toBundle())}),localStorage.visseria=JSON.stringify(h)}n.find(".js-class").append(Classes.$CLASS_SELECT.clone()),n.find(".js-gear").each((e,t)=>$(t).prepend(Gear.$GEAR_SELECT.clone().attr("data-slot",e))),d.on("click",function(){f(),g()}),r.on("click",".js-prompt-button",function(){"yes"===$(this).data("answer")&&(h={},y()),r.remove()}),$(document).on("change",v),c.on("change",function(){const e=int($(this).val());$(".js-character").each(function(t,a){const s=$(a).data("character");s&&s.updateLevel(e)})}),l.on("change",function(){o.find(".js-character").each(function(e,t){const a=$(t).data("character");a&&"zuciel"===a.name&&a.mod("dmg")})}),$(document).on("click",".js-delete-character",function(){$(this).closest(".js-character").remove(),g(),v()}),$(document).on("change",".js-class-select",function(){p($(this).closest(".js-character"),$(this).val())}),$(document).on("change",".js-gear-select",function(){const e=$(this).closest(".js-character").data("character");e&&(e.changeGear($(this).data("slot"),$(this).val())||$(this).val("-"))}),$(document).on("change",".js-status-mod",function(){const e=$(this).closest(".js-character").data("character");e&&e.mod($(this).data("status"))}),$(document).on("change",".js-hp-current, .js-recharge-current",function(){const e=$(this).closest(".js-character").data("character");e&&e.changeCurrent($(this).data("status"))});for(let e of["gear","ability"])$(document).on("click",".js-"+e+"-show-detail",function(){$(this).toggleClass("pressed"),$(this).parent().siblings(".js-"+e+"-detail").toggleClass("hidden")});if($(document).on("click",'.js-debuff input[type="checkbox"]',function(){$(this).parent().toggleClass("checked")}),m()&&localStorage.visseria)try{if(h=JSON.parse(localStorage.visseria),Object.keys(h).length>0&&!h[e])throw r.find(".js-prompt-message").html(i.MESSAGE),r.find(".js-prompt-button.no").html(i.NO),r.find(".js-prompt-button.yes").html(i.YES),r.removeClass("hidden"),"App was updated to version: "+e;if(c.val(h[e].key_shards),l.val(h[e].gold),h[e].characters)for(let t of h[e].characters)f(t)}catch(e){console.error("An error occurred while loading from storage:\n"+e),h={}}else m()&&(r.find(".js-prompt-message").html(s.MESSAGE),r.find(".js-prompt-button.no").html(s.NO),r.find(".js-prompt-button.yes").html(s.YES),r.removeClass("hidden"));0===o.find(".js-character").length&&f()});